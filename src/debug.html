<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard's Choice - Debug Mode</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/enhanced-style.css">
    <style>
        #console-log {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.8);
            color: #ccffcc;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
        }
        #console-log p {
            margin: 0;
            padding: 2px 0;
        }
        #console-log p.warning {
            color: #ffcc00;
        }
        #console-log p.error {
            color: #ff6666;
        }
        .clear-console {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #666;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
        }
        .hide-console {
            position: absolute;
            top: 5px;
            right: 60px;
            background: #666;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="game-container" id="game-container">
        <div id="loading-screen" class="loading-screen">
            <h1>Loading Wizard's Choice...</h1>
            <div class="loading-spinner"></div>
        </div>
        
        <div id="debug-controls" style="position: fixed; top: 10px; right: 10px; z-index: 9999; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px;">
            <button class="clear-console">Clear Console</button>
            <button class="test-spells">Test Spell Selection</button>
            <button id="debug-start-battle" style="background-color: #5030a0; color: white;">Force Start Battle</button>
        </div>
        
        <div id="main-menu" class="hidden">
            <h1>Wizard's Choice</h1>
            <button id="start-game">Start New Duel</button>
            <button id="options">Options</button>
        </div>
        <div id="game-ui" class="hidden">
            <div id="player-info">
                <div id="player-health"></div>
                <div id="player-mana"></div>
            </div>
            <div id="opponent-info">
                <div id="opponent-health"></div>
                <div id="opponent-mana"></div>
            </div>
            <div id="battle-scene"></div>
            <div id="spell-choices"></div>
            <div id="battle-log"></div>
            <div id="menu-button-container">
                <button id="menu-button" class="menu-button" aria-label="Menu">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
                    </svg>
                </button>
            </div>
        </div>
        <div id="game-over" class="hidden">
            <h2 id="result-message"></h2>
            <div id="battle-stats"></div>
            <button id="play-again">Play Again</button>
            <button id="return-to-menu">Return to Menu</button>
        </div>
        <div id="spell-selection-screen" class="hidden">
            <h2>Choose Your Spells</h2>
            <p>Select 3 spells to add to your hand for this battle:</p>
            <div id="available-spells-container" class="horizontal-cards"></div>
            <div class="spell-selection-footer">
                <span id="spells-selected-counter">0/3 Spells Selected</span>
                <button id="start-battle-button" disabled>Start Battle</button>
            </div>
        </div>
    </div>
    
    <div id="console-log">
        <button class="clear-console">Clear</button>
        <button class="hide-console">Hide</button>
    </div>
    
    <script>
        // Override console methods to display in our custom console
        (function() {
            const oldLog = console.log;
            const oldWarn = console.warn;
            const oldError = console.error;
            const consoleDiv = document.getElementById('console-log');
            
            // Add to console display
            function addLogEntry(message, level) {
                const p = document.createElement('p');
                if (level) p.classList.add(level);
                p.textContent = `${new Date().toISOString().substr(11, 8)} [${level || 'log'}]: ${message}`;
                consoleDiv.appendChild(p);
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
                
                // Limit entries to keep memory usage reasonable
                while (consoleDiv.children.length > 100) {
                    consoleDiv.removeChild(consoleDiv.firstChild);
                }
            }
            
            // Override console methods
            console.log = function() {
                oldLog.apply(console, arguments);
                addLogEntry(Array.from(arguments).join(' '));
            };
            
            console.warn = function() {
                oldWarn.apply(console, arguments);
                addLogEntry(Array.from(arguments).join(' '), 'warning');
            };
            
            console.error = function() {
                oldError.apply(console, arguments);
                addLogEntry(Array.from(arguments).join(' '), 'error');
            };
            
            // Button handlers
            document.querySelector('.clear-console').addEventListener('click', () => {
                while (consoleDiv.firstChild) {
                    if (consoleDiv.firstChild.tagName !== 'BUTTON') {
                        consoleDiv.removeChild(consoleDiv.firstChild);
                    }
                }
            });
            
            let consoleVisible = true;
            document.querySelector('.hide-console').addEventListener('click', () => {
                if (consoleVisible) {
                    consoleDiv.style.height = '30px';
                    document.querySelector('.hide-console').textContent = 'Show';
                } else {
                    consoleDiv.style.height = '200px';
                    document.querySelector('.hide-console').textContent = 'Hide';
                }
                consoleVisible = !consoleVisible;
            });
        })();
    </script>
    
    <script>
        document.querySelector('.test-spells').addEventListener('click', () => {
            // Insert testing code here
            console.log('Testing Spell Selection');
            
            const gameManager = window.gameManager;
            if (gameManager) {
                gameManager.showSpellSelection();
                
                // Add debug info for Start Battle button
                setTimeout(() => {
                    const startBattleButton = document.getElementById('start-battle-button');
                    if (startBattleButton) {
                        console.log('Start Battle button properties:');
                        console.log('- disabled:', startBattleButton.disabled);
                        console.log('- classList:', Array.from(startBattleButton.classList));
                        console.log('- style.display:', startBattleButton.style.display);
                        console.log('- getBoundingClientRect:', startBattleButton.getBoundingClientRect());
                        
                        // Add event listener debug
                        const oldClick = startBattleButton.onclick;
                        startBattleButton.onclick = function(e) {
                            console.log('Start Battle button clicked via onclick');
                            if (oldClick) oldClick(e);
                        };
                        
                        console.log('Added debug onclick handler to Start Battle button');
                    } else {
                        console.error('Start Battle button not found in debug mode');
                    }
                }, 500);
            } else {
                console.error('Game Manager not available in global scope');
            }
        });
        
        // Add debug start battle functionality
        document.getElementById('debug-start-battle').addEventListener('click', () => {
            console.log('Force Start Battle clicked');
            
            const gameManager = window.gameManager;
            if (gameManager) {
                // Manually select spells and start the battle
                console.log('Forcing battle initialization with default spells');
                
                // Get first 3 spells from the player's unlocked spells
                const unlockedSpells = gameManager.spellSystem.getPlayerUnlockedSpells();
                if (unlockedSpells && unlockedSpells.length >= 3) {
                    const selectedSpells = unlockedSpells.slice(0, 3).map(spell => spell.id);
                    console.log('Selected spells for forced battle:', selectedSpells);
                    
                    // Set the player's spell hand
                    gameManager.spellSystem.setPlayerSpellHand(selectedSpells);
                    
                    // Initialize the battle
                    gameManager.initializeBattle();
                } else {
                    console.error('Not enough spells unlocked to force battle start');
                }
            } else {
                console.error('Game Manager not available in global scope');
            }
        });
    </script>
    
    <script type="module" src="game/main.js"></script>
</body>
</html>
